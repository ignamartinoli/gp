<div class="div_section">
  <h3 class="siac_title">Vista Previa: <%= @componente.nombre %></h3>
  <br><br>

  <div class="tabs-container">
    <button class="tab-btn active" data-target="convocatoria">Convocatoria</button>
    <button class="tab-btn" data-target="autoevaluacion">AutoevaluaciÃ³n</button>
  </div>

  <div id="convocatoria" class="tab-content active">
    <%= render partial: 'formulario_preview', locals: { campos: @campos_convocatoria } %>
  </div>

  <div id="autoevaluacion" class="tab-content">
    <%= render partial: 'formulario_preview', locals: { campos: @campos_autoevaluacion } %>
  </div>

  <style>
    .tabs-container {
      border-bottom: 2px solid #ccc;
      display: flex;
      gap: 10px;
      margin-bottom: 1rem;
    }
    .tab-btn {
      padding: 15px;
      border: none;
      background: #eee;
      cursor: pointer;
      border-radius: 6px 6px 0 0;
      font-weight: bold;
      width: 50% ;
    }
    .tab-btn.active {
      background: hsla(var(--hue),var(--saturation), var(--brightness20),1);
      color: #fff;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
      animation: fadeIn 0.2s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tabs = document.querySelectorAll(".tab-btn");
      const contents = document.querySelectorAll(".tab-content");

      tabs.forEach(tab => {
        tab.addEventListener("click", () => {
          tabs.forEach(t => t.classList.remove("active"));
          contents.forEach(c => c.classList.remove("active"));
          tab.classList.add("active");
          document.getElementById(tab.dataset.target).classList.add("active");
        });
      });
    });

    document.addEventListener("input", e => {
      if (e.target.matches(".form-range")) {
        const label = e.target.nextElementSibling
        label.textContent = `${e.target.value}%`
      }
    })

    document.addEventListener("input", function (e) {
      if (e.target.matches(".tipo-campo-barra")) {
        const slider = e.target;
        const value = slider.value;
        const id = slider.id.split("_")[1];
        const label = document.getElementById(`valor_progreso_${id}`);

        label.textContent = `${value}%`;

        // ðŸ”¸ Usar el mismo color del tema dinÃ¡mico (usando las variables CSS)
        const rootStyles = getComputedStyle(document.documentElement);
        const hue = rootStyles.getPropertyValue("--hue");
        const sat = rootStyles.getPropertyValue("--saturation");
        const bri = rootStyles.getPropertyValue("--brightness20");

        const color = `hsla(${hue}, ${sat}, ${bri}, 1)`;

        slider.style.background = `linear-gradient(to right, ${color} ${value}%, #d6d6d6 ${value}%)`;
      }
    });
    function openDocenteDialog(id) {
      $('#' + id).dialog({
        modal: true,
        width: '70%',
        draggable: true,
        resizable: false,
        closeText: 'Cerrar'
      });
    }
    document.addEventListener('change', function (e) {
    if (e.target.id !== 'tipo_rol_select') return;

    const cargoSelect = document.getElementById('cargo_select');
    if (!cargoSelect) return;

    const cargosData = JSON.parse(cargoSelect.dataset.cargos || '{}');
    const tipo = e.target.value;

    cargoSelect.innerHTML = '<option value="">Seleccione cargo</option>';

    if (!tipo || !cargosData[tipo]) return;

    cargosData[tipo].forEach(cargo => {
      const opt = document.createElement('option');
      opt.value = cargo.id_cargo;
      opt.textContent = cargo.nombre;
      cargoSelect.appendChild(opt);
    });
    });


  </script>
</div>


<%= link_to 'Volver a componentes', componentes_path %>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'siac.css', plugin: :utn_siac %>
  <%= javascript_include_tag 'validaciones_componentes', plugin: :utn_siac %>
  <%= javascript_include_tag 'componentes', plugin: :utn_siac %>
  <%= javascript_include_tag 'stepper_plantel_docente', plugin: :utn_siac %>
  <%= csrf_meta_tags %>
<% end %>