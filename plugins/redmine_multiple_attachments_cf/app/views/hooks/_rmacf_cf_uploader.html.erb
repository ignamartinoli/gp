<% issue = @issue %>
<% cf_id = 278 %> <%# <= CAMBIÁ si tu CF es otro %>
<% cf = issue.try(:available_custom_fields).to_a.find{|c| c.id == cf_id } %>
<% if cf.present? %>
  <% raw_csv = issue.custom_field_value(cf.id).to_s %>
  <% ids     = raw_csv.split(',').map(&:strip).reject(&:blank?) %>
  <% atts    = ids.present? ? Attachment.where(id: ids).index_by{|a| a.id.to_s} : {} %>

  <!-- OJO: NO mostramos un label acá. Usamos el label original del <p> del CF -->
  <div class="rmacf-input" data-cf-id="<%= cf.id %>" id="rmacf-mount-<%= cf.id %>">
    <ul class="rmacf-list">
      <% ids.each do |aid| %>
        <% if (a = atts[aid]) %>
          <li class="rmacf-item rmacf-item--persisted" data-attachment-id="<%= a.id %>">
            <span class="rmacf-name"><%= h(a.filename) %></span>
            <span class="rmacf-meta"><%= number_to_human_size(a.filesize) %></span>
            <a href="<%= download_named_attachment_url(a, a.filename) %>" target="_blank" class="rmacf-link">ver</a>
            <button type="button" class="rmacf-remove" title="Quitar">&times;</button>
          </li>
        <% end %>
      <% end %>
    </ul>

    <div class="rmacf-drop">
      <input type="file" name="multiple_attachments_cf[<%= cf.id %>][]"
             multiple id="rmacf-input-<%= cf.id %>">
      <div class="rmacf-drop-hint">Arrastrá o click para elegir</div>
    </div>

    <input type="hidden" name="multiple_attachments_cf_remove[<%= cf.id %>]" value="">
  </div>

  <script>
    (function(){
      var cfId   = "<%= cf.id %>";
      var csvSel = "#issue_custom_field_values_" + cfId;
      var csv    = document.querySelector(csvSel);
      if (!csv) return;

      // 1) Encontrá el <p> original del CF y montá el uploader ahí adentro
      var p = csv.closest('p') || csv.parentElement;
      var mount = document.getElementById("rmacf-mount-" + cfId);
      if (p && mount && !p.contains(mount)) {
        // Ocultamos SOLO el input CSV, NO el <p> (así se ve el label nativo)
        csv.style.display = 'none';
        p.appendChild(mount);
      }

      // 2) un poquito de aire entre el label y la lista
      mount.style.marginTop = '4px';
    })();
  </script>
<% end %>
